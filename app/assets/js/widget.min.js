var SITE_URL = "https://loanoptions.ai/bannerad/";

const params = new Proxy(new URLSearchParams(window.location.search), {
    get: (searchParams, prop) => searchParams.get(prop),
});
if (params.partnerId) {
    localStorage.setItem('externalPartnerId', params.partnerId);
} else {
    // SET DEFAULT DRIVE IQ PARTNER(REQUIRED)
    if (localStorage.getItem("externalPartnerId") === null) {
        localStorage.setItem('externalPartnerId', '1385');
    }
    /* if (window.location.pathname == '/') {
         localStorage.setItem('externalPartnerId', '383');
     } else {
         if (localStorage.getItem("externalPartnerId") === null) {
             localStorage.setItem('externalPartnerId', '383');
         }
     }*/
}

// HOST URL
localStorage.setItem('sourceUrl', 'https://loanoptions.ai/bannerad/');
// SOURCE NAME
localStorage.setItem('source', 'LOANOPTIONS');
// TARGET SYSTEM
localStorage.setItem('targetSystem', 'SKYNET');

var sourceval = localStorage.getItem("source");
var sourceUrl = localStorage.getItem("sourceUrl");
var externalPartnerId = localStorage.getItem("externalPartnerId");
var targetSystem = localStorage.getItem("targetSystem");

if (localStorage.getItem("quote") === null) {
    let quote = {
        type: "CAR_LOAN",
        usage: "CONSUMER",
        amount: "50000",
        term: "5",
        source: sourceval,
        sourceUrl: sourceUrl,
        targetSystem: targetSystem,
        externalPartnerId: externalPartnerId,
    }
    localStorage.setItem('quote', JSON.stringify(quote));
}

function generate(n) {
    var add = 1,
        max = 12 - add; // 12 is the min safe number Math.random() can generate without it starting to pad the end with zeros.   

    if (n > max) {
        return generate(max) + generate(n - max);
    }

    max = Math.pow(10, n + add);
    var min = max / 10; // Math.pow(10, n) basically
    var number = Math.floor(Math.random() * (max - min + 1)) + min;

    return ("" + number).substring(add);
}

var gid = generate(12);

if (localStorage.getItem("quoteId") === null) {
    if (localStorage.getItem("uid") === null) {
        localStorage.setItem("uid", gid);
    } else {

    }
} else {
    localStorage.setItem("uid", localStorage.getItem("quoteId"));
}

var slider = document.getElementById("borrowrange");
var output = document.getElementById("borrowtext");
output.value = slider.value;

slider.oninput = function () {
    output.value = slider.value;
    if (($(".buttongroupmirror.active").data('loan') == "Business Loan" || $(".buttongroupmirror.active2").data('loan') == "Business Use" || $(".business-loan-page-layout").length > 0) && $("#borrowtext").parent('div').text() == '' && slider.value == 100000) {
        $("#borrowtext").focus();
        $("#borrowtext").parent('div').append('<span class="evtext" style="font-size:13px;color:red;display: block;">please enter your amount</span>');
    } else {
        $(".evtext").remove();
    }
}

function updateValue(e) {

    slider.value = e.target.value;
}

output.addEventListener('change', updateValue);

var yslider = document.getElementById("yearrange");
var youtput = document.getElementById("yeartext");
youtput.value = yslider.value;

yslider.oninput = function () {
    youtput.value = yslider.value;
    console.log(yslider.value);
}

function yupdateValue(e) {
    yslider.value = e.target.value;
}

youtput.addEventListener('change', yupdateValue);

// SET CSS PROPERTY
document.documentElement.style.setProperty('--widgetPrimary', '#5614BB');
document.documentElement.style.setProperty('--widgetSecondary', '#5614BB');
document.documentElement.style.setProperty('--widgetTertiary', '#5614BB');
document.documentElement.style.setProperty('--widgetQuaternary', '#f2f2f2');

jQuery(document).on("click", ".buttongroupmirror", function () {
    var txt = $(this).data('loan');
    if (txt == "Business Loan") {
        $("#yearrange").attr('max', 3);
        $("#yearrange").attr('value', 2);
        $("#yearrange").val(2);
        $("#yeartext").val(2);
        $("#yearrange").trigger('change');
        yslider.value = 2;
    } else {
        $("#yearrange").attr('max', 7);
        $("#yearrange").attr('value', 5);
        $("#yearrange").val(5);
        $("#yeartext").val(5);
        $("#yearrange").trigger('change');
        yslider.value = 5;
    }
    if (txt == "Car Loan") {
        $(".fieldgroup").hide();
        $(".fieldgroup-2").fadeIn();
        $(".buttongroupmirror.active").removeClass("active");
        $(this).addClass("active");
    } else if (txt == "Personal Use" || txt == "Business Use") {
        $(".fieldgroup").hide();
        $(".fieldgroup-3").fadeIn();
        $(".buttongroupmirror.active2").removeClass("active2");
        $(this).addClass("active2");
    } else {
        $(".fieldgroup").hide();
        $(".fieldgroup-3").fadeIn();
        $(".buttongroupmirror.active").removeClass("active");
        $(this).addClass("active");

    }
});

jQuery(document).on("click", ".fieldgroupprev", function () {
    $(".fieldgroup").hide();
    $(".fieldgroup-1").fadeIn();
});

jQuery(document).on("click", ".fieldgroupnext", function (e) {
    e.preventDefault();
    $(".fieldgroup").hide();
    $(".fieldgroup-3").fadeIn();
});

jQuery(document).on("click", ".fieldgroupprev-2", function () {
    $(".fieldgroup").hide();
    $(".fieldgroup-4").fadeIn();
});


// General 
function loansubmit(typeval, usageval) {
    var amount = $("#borrowtext").val();
    var year = $("#yeartext").val();
    var sourceval = 'LOANOPTIONS';
    var sourceUrl = 'https://carinspect.aiims-staging.com.au';
    var externalPartnerId = '1385';
    var targetSystem = 'SKYNET';
    // var sourceval = 'localStorage.getItem("source")';
    // var sourceUrl = localStorage.getItem("sourceUrl");
    // var externalPartnerId = localStorage.getItem("externalPartnerId");
    // var targetSystem = localStorage.getItem("targetSystem");
    let quote = {
        type: typeval,
        usage: usageval,
        amount: amount,
        term: year,
        source: sourceval,
        sourceUrl: sourceUrl,
        targetSystem: targetSystem,
        externalPartnerId: externalPartnerId,
    }
    localStorage.setItem('quote', JSON.stringify(quote));
}

function redirectapplication() {
    window.location.href = SITE_URL + '/application';
}

// home page widget

function loanwidgetsubmitquote() {
    var type = $(".buttongroupmirror.active2").data('loan');
    var loantypemain = $(".buttongroupmirror.active").data('loan');
    var ltype = 'CAR_LOAN';

    if (loantypemain == "Equipment Loan") {
        ltype = 'EQUIPMENT_LOAN';
    } else if (loantypemain == "Personal Loan") {
        ltype = 'PERSONAL_LOAN';
        type = "Personal Use";
    } else if (loantypemain == "Business Loan") {
        ltype = 'BUSINESS_LOAN';
        type = "Business Use";
    } else if (loantypemain == "Home Loan") {
        ltype = 'HOME_LOAN';
        type = loantypemain;
    }

    var usage = (type == "Business Use" || ltype == 'EQUIPMENT_LOAN') ? 'COMMERCIAL_FULL_DOC' : 'CONSUMER';
    return Array(ltype, usage);
}

if ($(".loanwidgetsubmit-submit").length > 0) {
    var arr = loanwidgetsubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}

jQuery(document).on("click", ".loanwidgetsubmit", function (e) {
    e.preventDefault();
    var arr = loanwidgetsubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});



// Car Loan
function carloansubmitquote() {
    var type = $("#loantype").val();
    var loantype = (type == "Business") ? 'COMMERCIAL_FULL_DOC' : 'CONSUMER';
    return Array("CAR_LOAN", loantype);
}
if ($(".carloan-submit").length > 0) {
    var arr = carloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}

jQuery(document).on("click", ".carloan-submit", function () {
    var arr = carloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

// Personal Loan
function personalloansubmitquote() {
    return Array("PERSONAL_LOAN", "CONSUMER");
}
if ($(".personalloan-submit").length > 0) {
    var arr = personalloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".personalloan-submit", function () {
    var arr = personalloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

// Business Loan

function businessloansubmitquote() {
    return Array("BUSINESS_LOAN", "COMMERCIAL_FULL_DOC");
}
if ($(".businessloan-submit").length > 0) {
    var arr = businessloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".businessloan-submit", function () {
    var arr = businessloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

//Equipment Loan
function equipmentloansubmitquote() {
    return Array("EQUIPMENT_LOAN", "COMMERCIAL_FULL_DOC");
}
if ($(".equipment-submit").length > 0) {
    var arr = equipmentloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}

jQuery(document).on("click", ".equipment-submit", function () {
    var arr = equipmentloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

//Motorcycle Loan
function motorcycleloansubmitquote() {
    return Array("MOTORCYCLE_LOAN", "CONSUMER");
}
if ($(".motorcycle-loansubmit").length > 0) {
    var arr = motorcycleloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".motorcycle-loansubmit", function () {
    var arr = motorcycleloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});


//Marine Loan
function marinloansubmitquote() {
    return Array("PERSONAL_LOAN", "CONSUMER");
}
if ($(".marin-loansubmit").length > 0) {
    var arr = marinloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".marin-loansubmit", function () {
    var arr = marinloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

//Truck Loan
function truckloansubmitquote() {
    return Array("EQUIPMENT_LOAN", "COMMERCIAL_FULL_DOC");
}
if ($(".truck-loansubmit").length > 0) {
    var arr = truckloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".truck-submit", function () {
    var arr = truckloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

//Medical Loan
function medicalloansubmitquote() {
    return Array("PERSONAL_LOAN", "CONSUMER");
}
if ($(".medical-loansubmit").length > 0) {
    var arr = medicalloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".medical-loansubmit", function () {
    var arr = medicalloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

//Beauty-loan 
function beautyloansubmitquote() {
    return Array("PERSONAL_LOAN", "CONSUMER");
}
if ($(".beauty-loansubmit").length > 0) {
    var arr = beautyloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".beauty-loansubmit", function () {
    var arr = beautyloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});

//Caravan
function caravanloansubmitquote() {
    return Array("CARAVAN_LOAN", "CONSUMER");
}
if ($(".caravan-loansubmit").length > 0) {
    var arr = caravanloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
}
jQuery(document).on("click", ".caravan-loansubmit", function () {
    var arr = caravanloansubmitquote();
    var typeval = arr[0];
    var usageval = arr[1];
    loansubmit(typeval, usageval);
    redirectapplication();
});